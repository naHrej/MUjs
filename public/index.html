<!-- index.html -->
<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">

<head>
        <meta charset="UTF-8" />
        <!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP -->
        <title>MU*JS</title>
        <!-- Include the style sheet style.css -->
        <link rel="stylesheet/less" type="text/css" href="style.less" />
        <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
        <script src="../node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/less"></script>
        <link href="https://cdn.bootcdn.net/ajax/libs/monaco-editor/0.20.0/min/vs/editor/editor.main.min.css"
                rel="stylesheet" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>
</head>

<body>
        <div id="appRoot">
                <div id="conmgr" v-show="showMgr">
                        <div>
                                <div v-for="(site, key) in sites" :key="key" class="card mb-3">
                                        <div v-if="editingSiteKey === key">
                                                <!-- Editable form -->
                                                <input v-model="site.name" type="text">
                                                <input v-model="site.host" type="text">
                                                <input v-model="site.port" type="text">
                                                <button @click="saveSite" class="btn btn-primary">Save</button>
                                        </div>
                                        <div v-else>
                                                <!-- Site details -->
                                                <h5 class="card-title">{{ site.name }}</h5>
                                                <p class="card-text">{{ site.host }}:{{ site.port }}</p>
                                                <button @click="selectSite(key)" class="btn btn-primary">Select</button>
                                                <button @click="editSite(key)" class="btn btn-secondary">Edit</button>
                                                <button @click="deleteSite(key)" class="btn btn-danger">Delete</button>
                                        </div>
                                </div>
                                <button @click="addSite" class="btn btn-success">Add New Site</button>
                        </div>
                </div>
        </div>


        <div id="app">
                <div v-show="showApp">
                        <div class="flex-container">
                                <div id="AZUHz3kQsgMj">
                                </div>
                                <div id="resizeHandle" style="height: 5px; cursor: ns-resize; background-color: #ccc;">
                                </div>
                                <div ref="inputField" class="monaco-editor" id="SdWiqHtqa" v-model="inputField"
                                        @keydown="handleKeydown">
                                        </textarea>
                                </div>
                        </div>
                </div>

                <script>
                        require.config({ paths: { 'vs': 'https://cdn.bootcdn.net/ajax/libs/monaco-editor/0.20.0/min/vs' } });

                        require(['vs/editor/editor.main'], function () {

                                monaco.languages.register({ id: 'moocode' });

                                monaco.languages.setMonarchTokensProvider('moocode', {
                                        tokenizer: {
                                                root: [
                                                        // Keywords
                                                        // comment starts with //
                                                        [/\/\/.*$/, "comment"],
                                                        [/\b(if|while|for|return|endif|endwhile|endfor|else|elseif|in|this|try|except|finally|endtry)\b/, "keyword.control"],
                                                        [/\b(typeof|toint|tofloat|toobj|tostr|raise)\b/, "keyword.other"],
                                                        [/\b(INT|NUM|FLOAT|LIST|MAP|STR|ANON|OBJ|ERR)\b/, "constant.numeric"],
                                                        [/@(program|args|verb)\b/, "markup.heading"],
                                                        // Special handling for object:verb
                                                        // Capture object and verb separately
                                                        [/(\w+)([:])(\w+)\b/, ["object", "delimiter", "verb"]],
                                                        // Special handling for object.property
                                                        // Capture object and property separately
                                                        [/(\w+)([.]\w+)\b/, ["object", "property"]],
                                                        // special handling for object_ref:verb
                                                        // Capture object_ref and verb separately
                                                        [/$(\w+)([:])(\w+)\b/, ["object_ref", "delimiter", "verb"]],
                                                        // special handling for object_ref.property
                                                        // Capture object_ref and property separately
                                                        [/$(\w+)([.]\w+)\b/, ["object_ref", "property"]],
                                                        // Special handling for object_ref
                                                        [/$(\w+)\b/, "object_ref"],
                                                        // Special handling for object
                                                        [/\b(\w+)\b/, "object"],

                                                        [/\b(?:\d+(?:\.\d*)?|\.\d+)\b/, "constant.numeric.moo"],
                                                        // Strings
                                                        [/"/, { token: "string.quoted.double.moo", next: "@string" }],
                                                ],
                                                string: [
                                                        [/[^\\"]+/, "string"],
                                                        [/\\./, "constant.character.escape.moo"],
                                                        [/"/, { token: "string.quoted.double.moo", next: "@pop" }],
                                                ]
                                        }
                                });

                                monaco.editor.defineTheme("moocode", {
                                        base: 'vs-dark',
                                        inherit: true,
                                        rules: [

                                                { token: 'property', foreground: '2596be' },
                                                { token: 'object', foreground: '76b5c5' },
                                                // green for verbs
                                                { token: 'verb', foreground: 'a6e22e' },
                                                // yellow for perenthesis
                                                { token: 'delimiter.parenthesis', foreground: 'f8f8f2' },
                                                // light purple for object_ref
                                                { token: 'object_ref', foreground: 'bd93f9' },

                                        ],
                                })
                                editor = monaco.editor.create(document.getElementById('SdWiqHtqa'), {
                                        value: "",
                                        language: 'moocode',
                                        theme: "moocode",
                                });
                        });
                </script>
                <script src="../node_modules/vue/dist/vue.global.js"></script>
                <script src="../src/render/mainRenderer.js"></script>
                <script src="../src/render/conmgr.js"></script>
</body>

</html>